== Basic Approach
:existing_tables_foot1: footnote:[See ]
This extension extends the existing GeoPackage Encoding Standard<<1>> and leverages the existing structure for raster tiles. The existing tile set tables (http://www.geopackage.org/spec/#_tile_matrix_set[GPKG 2.2.6], http://www.geopackage.org/spec/#tile_matrix[GPKG 2.2.7], and http://www.geopackage.org/spec/#tiles_user_tables[GPKG 2.2.8]) are used as normal with the following changes:

*	A new value of `2D-gridded-coverage` is allowed in the `data_type` column of the http://www.geopackage.org/spec/#_contents[`gpkg_contents`] table.
* There is a new table called `gpkg_2D_gridded_coverage_ancillary` as described in <<gpkg_2D_gridded_coverage_ancillary_table>>.
* There are new columns in the http://www.geopackage.org/spec/#tiles_user_tables[tile pyramid user data tables] as described in <<updated_tile_matrix_set_table>> (we foresee these columns being used in other extensions which also leverage the tiles approach). When used for elevation data the new columns have the following values:
** content: `tiled-elevation`
** ancillary_table: `gpkg_elevation_ancillary`
** ancillary_key: (foreign key to row in `gpkg_elevation_ancillary`)
* *TODO: Tile-level ancillary data too!*
* PNG files are used for 16-bit integer (signed or unsigned) data
*	TIFF files are used for 32-bit floating point data. These files are constrained as follows:
**	One sample per pixel
**	LZW compression may be used
**	No subfiles or internal tiles
*	ISO metadata (optionally) to encode other details about the elevation data.

== MIME Type
[requirement] (extends http://www.geopackage.org/spec/#_requirement-35[GPKG-35],  http://www.geopackage.org/spec/#_requirement-36[GPKG-36])
A GeoPackage that contains a tile pyramid user data table MAY store BLOBs in the `tile_data` column in MIME type `image/tiff`. The content of the data table SHALL NOT be raster tiles as per the core specification and SHALL be described by an extension such as this one.

== Table Definitions
[[coverage_ancillary]]
=== Coverage Ancillary
[requirement] A GeoPackage that contains tiled gridded elevation data SHALL contain a `gpkg_2D_gridded_coverage_ancillary` table or view as per <<gpkg_2D_gridded_coverage_ancillary_table>>.

[[gpkg_2D_gridded_coverage_ancillary_table]]
.Coverage Ancillary Table Definition
[cols=",,,,,",options="header",]
|=======================================================================
|Column Name |Column Type |Column Description |Null |Default |Key
|`id`|INTEGER	|Autoincrement primary key|no||PK
|`datatype`|TEXT	|'float' or 'integer'|no||
|`uom`|TEXT|unit of measure, as per UCUM<<3>>|no||
|`scale`|REAL|Scale as a multiple relative to the unit of measure|yes|1|
|`offset`|REAL|The offset to the 0 value|yes|0|
|`precision`|REAL|The smallest value that has meaning for this dataset|yes|if datatype is integer then 1, otherwise undefined|
|`data_null`|REAL|The value that indicates NULL|yes||
|`data_missing`|REAL|The value that indicates data is missing|yes||
|=======================================================================

=== Tile Matrix Set (Updated)
[requirement] (extends http://www.geopackage.org/spec/#_requirement-37[GPKG-37]) A GeoPackage that contains tiled gridded elevation data SHALL contain a `gpkg_tile_matrix_set` table or view as per <<updated_tile_matrix_set_table>>.

[[updated_tile_matrix_set_table]]
.Updated Tile Matrix Set Table Definition
[cols=",,,,,",options="header",]
|=======================================================================
|Column Name |Column Type |Column Description |Null |Default |Key
|`table_name`|TEXT	|As Per http://www.geopackage.org/spec/#_tile_matrix_set[GPKG 2.2.6] |no||PK,FK
|`srs_id`|INTEGER	|As Per http://www.geopackage.org/spec/#_tile_matrix_set[GPKG 2.2.6] |no||FK
|`min_x`|DOUBLE|As Per http://www.geopackage.org/spec/#_tile_matrix_set[GPKG 2.2.6] |no||
|`max_x`|DOUBLE|As Per http://www.geopackage.org/spec/#_tile_matrix_set[GPKG 2.2.6] |no||
|`min_y`|DOUBLE|As Per http://www.geopackage.org/spec/#_tile_matrix_set[GPKG 2.2.6] |no||
|`max_y`|DOUBLE|As Per http://www.geopackage.org/spec/#_tile_matrix_set[GPKG 2.2.6] |no||
|`content`|TEXT|Type of tile content|yes|`tiles`|
|`ancillary_table`|TEXT|Name of the table|yes||
|`ancillary_id`|INTEGER|Foreign Key in the ancillary table|yes||
|=======================================================================


== Table Values
=== `gpkg_contents`
[requirement] (extends http://www.geopackage.org/spec/#_requirement-34[GPKG-34]) The http://www.geopackage.org/spec/#_contents[`gpkg_contents`] table SHALL contain a row with a `data_type` column value of `2D-gridded-coverage` for each tile pyramid containing tiled gridded elevation data.

=== `gpkg_tile_matrix_set`
The following requirements refer to the `gpkg_tile_matrix_set` table as per <<updated_tile_matrix_set_table>>.

[requirement] (extends http://www.geopackage.org/spec/#_requirement-39[GPKG-39]) Values of the `gpkg_tile_matrix_set` `table_name` column SHALL reference values in the `gpkg_contents` `table_name` column for rows with a `data_type` of `2D-gridded-coverage`.

[requirement] (extends http://www.geopackage.org/spec/#_requirement-40[GPKG-40]) Rows in the `gpkg_tile_matrix_set` table that have a `content` value of 'NULL' or `tiles` SHALL refer to raster tile matrix pyramids as per the core specification<<1>>. In this case values in the `ancillary_table` or `ancillary_id` columns SHALL NOT be used.

[requirement] (extends http://www.geopackage.org/spec/#_requirement-40[GPKG-40]) For each tile pyramid user data table containing tiled gridded elevation data, rows in the `gpkg_tile_matrix_set` table SHALL contain the values denoted in <<gpkg_tile_matrix_set_req_values>>.

[[gpkg_tile_matrix_set_req_values]]
.Required Column Values in Tile Matrix Set Table
[cols=",",options="header",]
|=============================================
|Column Name	|Value|
|`content` |`tiled-elevation`|
|`ancillary_table`	|`gpkg_2D_gridded_coverage_ancillary`|
|=============================================

[requirement] For each row in the `gpkg_tile_matrix_set` table that references tiled gridded elevation data, the value of the `ancillary_id` column SHALL reference a value in the `gpkg_2D_gridded_coverage_ancillary` id column.

=== Tile Pyramid User Data Tables
[requirement] (extends http://www.geopackage.org/spec/#_requirement-36[GPKG-36], http://www.geopackage.org/spec/#_requirement-37[GPKG-37]) For tile pyramids with a `gpkg_2D_gridded_coverage_ancillary` `datatype` of 'integer', the `tile_data` BLOB in the tile pyramid user data table SHALL be of MIME type `image/png`.

[requirement] (extends http://www.geopackage.org/spec/#_requirement-36[GPKG-36], http://www.geopackage.org/spec/#_requirement-37[GPKG-37]) For tile pyramids with a `gpkg_2D_gridded_coverage_ancillary` `datatype` of 'float', the `tile_data` BLOB in the tile pyramid user data table SHALL be of MIME type `image/tiff`.

== TIFF Encoding
[requirement] (constrains TIFF<<2>> Section 2) A TIFF file storing tiled gridded elevation data SHALL have one sample per pixel.

[requirement] (constrains TIFF<<2>> Section 2) A TIFF file storing tiled gridded elevation data SHALL have the 32-bit floating (FLOAT â€“ 11) data type.

[requirement] A TIFF file storing tiled gridded elevation data MAY use the LZW compression option as per TIFF<<2>> Section 13. Client applications SHALL support this option.

[requirement] (constrains TIFF<<2>> Section 2) A TIFF file storing tiled gridded elevation data SHALL NOT contain multiple images per TIFF file.

[requirement] (constrains TIFF<<2>> Section 15) A TIFF file storing tiled gridded elevation data SHALL NOT contain internal tiles as per TIFF Section 15.
