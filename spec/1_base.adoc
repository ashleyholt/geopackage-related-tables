== Basic Approach
:existing_tables_foot1: footnote:[See ]
This extension extends the existing GeoPackage Encoding Standard<<1>> and leverages the existing structure for raster tiles. The existing tile set tables (http://www.geopackage.org/spec/#_tile_matrix_set[GPKG 2.2.6], http://www.geopackage.org/spec/#tile_matrix[GPKG 2.2.7], and http://www.geopackage.org/spec/#tiles_user_tables[GPKG 2.2.8]) are used as normal with the following changes:

*	A new value of `2D-gridded-coverage` is allowed in the `data_type` column of the http://www.geopackage.org/spec/#_contents[`gpkg_contents`] table.
* There are new tables
** `gpkg_2D_gridded_coverage_ancillary` as described in <<gpkg_2D_gridded_coverage_ancillary_table>>.
** `gpkg_2D_gridded_tile_ancillary` as described in <<gpkg_2D_gridded_tile_ancillary_table>>.
* PNG files are used for 16-bit integer (signed or unsigned) data
*	TIFF files are used for 32-bit floating point data. These files are constrained as follows:
**	One sample per pixel
**	LZW compression may be used
**	No subfiles or internal tiles
*	ISO metadata (optionally) to encode other details about the elevation data.

== MIME Type
[requirement] (extends http://www.geopackage.org/spec/#_requirement-35[GPKG-35],  http://www.geopackage.org/spec/#_requirement-36[GPKG-36])
A GeoPackage that contains a tile pyramid user data table MAY store BLOBs in the `tile_data` column in MIME type `image/tiff`. The content of the data table SHALL NOT be raster tiles as per the core specification and SHALL be described by an extension such as this one.

== Table Definitions
[[coverage_ancillary]]
=== Coverage Ancillary
[requirement] A GeoPackage that contains tiled gridded elevation data SHALL contain a `gpkg_2D_gridded_coverage_ancillary` table or view as per <<gpkg_2D_gridded_coverage_ancillary_table>>.

[[gpkg_2D_gridded_coverage_ancillary_table]]
.Coverage Ancillary Table Definition
[cols=",,,,,",options="header",]
|=======================================================================
|Column Name |Column Type |Column Description |Null |Default |Key
|`id`|INTEGER	|Autoincrement primary key|no||PK
|`tile_matrix_set_id`|INTEGER|Foreign key to http://www.geopackage.org/spec/#tile_matrix_set_data_table_definition)[`gpkg_tile_matrix_set`]|no||FK
|`datatype`|TEXT	|'float' or 'integer'|no||
|`uom`|TEXT|unit of measure, as per UCUM<<3>>|no||
|`scale`|REAL|Scale as a multiple relative to the unit of measure|yes|1|
|`offset`|REAL|The offset to the 0 value|yes|0|
|`precision`|REAL|The smallest value that has meaning for this dataset|yes|if datatype is integer then 1, otherwise undefined|
|`data_null`|REAL|The value that indicates NULL|yes||
|`data_missing`|REAL|The value that indicates data is missing|yes||
|=======================================================================

=== Tile Ancillary
[requirement] A GeoPackage that contains tiled gridded elevation data SHALL contain a `gpkg_2D_gridded_tile_ancillary` table or view as per <<gpkg_2D_gridded_tile_ancillary_table>>.

[[gpkg_2D_gridded_tile_ancillary_table]]
.Tile Ancillary Table Definition
[cols=",,,,,",options="header",]
|=======================================================================
|Column Name |Column Type |Column Description |Null |Key
|`id`|INTEGER	|Autoincrement primary key|no|PK
|`tpudt_name`|TEXT	|Name of tile pyramid user data table|no|PK
|`tpudt_id`|INTEGER	|Foreign key in tile pyramid user data table|no|PK
|`min`|REAL|Minimum value of this tile|yes|
|`max`|REAL|Maximum value of this tile|yes|
|`mean`|REAL|The arithmetic mean of values in this tile|yes|
|`std_dev`|REAL|The standard deviation of values in this tile|yes|
|=======================================================================

== Table Values
=== `gpkg_contents`
[requirement] (extends http://www.geopackage.org/spec/#_requirement-34[GPKG-34]) The http://www.geopackage.org/spec/#_contents[`gpkg_contents`] table SHALL contain a row with a `data_type` column value of `2D-gridded-coverage` for each tile pyramid containing tiled gridded elevation data.

=== `gpkg_2D_gridded_coverage_ancillary`
The following requirements refer to the `gpkg_2D_gridded_coverage_ancillary` table as per <<gpkg_2D_gridded_coverage_ancillary_table>>.

[requirement] Values of the `tile_matrix_set_id` column SHALL reference values in the `gpkg_tile_matrix_set` `id` column.

=== `gpkg_2D_gridded_tile_ancillary`
The following requirements refer to the `gpkg_2D_gridded_tile_ancillary` table as per <<gpkg_2D_gridded_tile_ancillary_table>>.

[requirement] Values of the `tpudt_name` column SHALL reference existing http://www.geopackage.org/spec/#tiles_user_tables[tile pyramid user data tables].

[requirement] Values of the `tpudt_id` column SHALL reference values in `id` column of the table referenced in `tpudt_name`.

=== Tile Pyramid User Data Tables
[requirement] For tile pyramids with a `gpkg_2D_gridded_coverage_ancillary` `datatype` of 'integer', the `tile_data` BLOB in the tile pyramid user data table SHALL be of MIME type `image/png` and the data SHALL be 16-bit grayscale.

[requirement] (extends http://www.geopackage.org/spec/#_requirement-36[GPKG-36], http://www.geopackage.org/spec/#_requirement-37[GPKG-37]) For tile pyramids with a `gpkg_2D_gridded_coverage_ancillary` `datatype` of 'float', the `tile_data` BLOB in the tile pyramid user data table SHALL be of MIME type `image/tiff` as described in <<tiff_encoding>>.

== TIFF Encoding
[[tiff_encoding]]
[requirement] (constrains TIFF<<2>> Section 2) A TIFF file storing tiled gridded elevation data SHALL have one sample per pixel.

[requirement] (constrains TIFF<<2>> Section 2) A TIFF file storing tiled gridded elevation data SHALL have the 32-bit floating (FLOAT â€“ 11) data type.

[requirement] A TIFF file storing tiled gridded elevation data MAY use the LZW compression option as per TIFF<<2>> Section 13. Client applications SHALL support this option.

[requirement] (constrains TIFF<<2>> Section 2) A TIFF file storing tiled gridded elevation data SHALL NOT contain multiple images per TIFF file.

[requirement] (constrains TIFF<<2>> Section 15) A TIFF file storing tiled gridded elevation data SHALL NOT contain internal tiles as per TIFF Section 15.
